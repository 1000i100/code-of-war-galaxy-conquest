var name="basicIA_JS";var color=0;var debugMessage="";var turn=0;var myPoints=new Array;var oponentPoints=new Array;var diffPoints=new Array;var gameScore=new Array;var maxGameScore=0;var WIN_ZONE=150;var DEFENSIVE_STRAT=1.3;var POP_SEUIL_1=-30;var POP_SEUIL_2=-50;var CREW_DRAW1=30;var CREW_DRAW2=30;var FP_DRAW1=[POP_SEUIL_1,CREW_DRAW1,DEFENSIVE_STRAT];var FP_DRAW2=[POP_SEUIL_2,CREW_DRAW2,DEFENSIVE_STRAT];var FP_WIN1=[-30,15,DEFENSIVE_STRAT];var FP_WIN2=[-20,20,DEFENSIVE_STRAT];var FP_WIN3=[-300,5,DEFENSIVE_STRAT];var FP_LOOSE=[-55,55,DEFENSIVE_STRAT];var RANGE=[-1,-5,-10,-15,-20];var AGRESSIVITY=[-300,0,10,20,30];var ATTACK_STRAT=.5;var RANGE_1=-1;var AGRESSIVITY_1=10;var RANGE_2=0;var AGRESSIVITY_2=10;var AGRESSIVITY_3=-100;var AGRESSIVITY_4=-300;var SP_DRAW1=[RANGE_1,AGRESSIVITY_1,ATTACK_STRAT];var SP_DRAW2=[RANGE_2,AGRESSIVITY_2,ATTACK_STRAT];var SP_WIN1=[RANGE_2,AGRESSIVITY_3,ATTACK_STRAT];var SP_WIN2=[RANGE_2,AGRESSIVITY_4,0];var SP_WIN3=[RANGE_2,AGRESSIVITY_4,0];var SP_LOOSE=[RANGE_2,AGRESSIVITY_2,ATTACK_STRAT];var score_weights=SP_DRAW1;var firing_params=FP_DRAW1;var FIRING_POP=[20,30,50,100,300];var CREW_SIZE=[5,10,20,30,50];var zone="fighting";var id=0;var oponentId=-1;onmessage=function(e){if(e.data!=null){var t=e.data;id=t.playerId;postMessage(new TurnResult(getOrders(t.galaxy),debugMessage))}else postMessage("data null")};var getOrders=function(e){var t=new Array;var n=GameUtil.getPlayerPlanets(id,e);var r=GameUtil.getEnnemyPlanets(id,e);if(oponentId<0)oponentId=getOtherPlayerId(id,e);var i=getOtherPlayerPlanets(oponentId,e);var s=0;myPoints.push(getPlayerScore(id,e));oponentPoints.push(getPlayerScore(oponentId,e));diffPoints.push(myPoints[turn]-oponentPoints[turn]);if(turn==0)gameScore.push(0);else gameScore.push(1e3*diffPoints[turn]/turn);if(gameScore[turn]>maxGameScore)maxGameScore=gameScore[turn];debugMessage="Points : "+myPoints[turn]+","+oponentPoints[turn]+","+diffPoints[turn]+","+turn;if(turn>=10)s=diffPoints[turn]-diffPoints[turn-10];debugMessage+=" | ROC10 :"+s;debugMessage+=" | Score :"+gameScore[turn];debugMessage+=" | maxScore :"+maxGameScore;turn++;if(r!=null&&r.length>0&&i!=null&&i.length>0&&n!=null&&n.length>0){var o=n.length,u=i.length,a=r.length-i.length;modifyFiringParameters(o,u,a,e);modifyScoreParameters(o,u,a,e);for(var f=0;f<n.length;f++){var l=n[f];if((zone=="protecting"||zone=="filling")&&getNearestPlanet(i[0],n)==l){var c=5;t.push(new Order(l.id,i[0].id,c))}else{if(firingScore(id,l,e)>=0){var c=Math.min(firing_params[1],l.population);if(zone=="filling")t.push(new Order(l.id,getMyPlanetToFill(l,n).id,c));if(zone=="fighting"||zone=="protecting")t.push(new Order(l.id,getBestScoredPlanet(l,r,e).id,c))}else if(firingScore(id,l,e)==-1e3){debugMessage+=" | fuite de la planète "+l.id;var c=l.population;t.push(new Order(l.id,getBestScoredPlanet(l,r,e).id,c))}else if(l.population==PlanetPopulation.getMaxPopulation(l.size)){debugMessage+=" | attaque cause pleine, planète "+l.id;var c=5;t.push(new Order(l.id,getBestScoredPlanet(l,r,e).id,c))}}}}return t};var getPlayerScore=function(e,t){var n=0;var r=getPlayerFlyingCrew(e,t);var i=getPlayerPopulationOnPlanets(e,t);return n=r+i};var getPlayerFlyingCrew=function(e,t){var n=0;var r=GameUtil.getPlayerFleet(e,t);if(r!=null){for(var i=0;i<r.length;i++)n+=r[i].crew}return n};var getPlayerPopulationOnPlanets=function(e,t){var n=0;var r=GameUtil.getPlayerPlanets(e,t);if(r!=null){for(var i=0;i<r.length;i++)n+=r[i].population}return n};var getPlayerFlyingCrewToPlanet=function(e,t,n){var r=0;var i=getPlayerShipsToPlanet(e,t,n);if(i!=null){for(var s=0;s<i.length;s++)r+=i[s].crew}return r};var getPlayerShipsToPlanet=function(e,t,n){var r=GameUtil.getPlayerFleet(e,n);var i=new Array;if(r!=null){for(var s=0;s<r.length;s++){if(r[s].target.id==t.id)i.push(r[s])}}return i};var getPlanetScore=function(e,t,n){var r=getPlayerFlyingCrewToPlanet(oponentId,t,n);var i=getPlayerFlyingCrewToPlanet(id,t,n);var s=0;s=s-t.population;s=s+score_weights[0]*GameUtil.getTravelNumTurn(e,t);if(t.owner.id==oponentId)s=s+score_weights[1];s=s+score_weights[2]*(i-r);if(i-r>PlanetPopulation.getMaxPopulation(t.size))s=s-500;return s};var firingScore=function(e,t,n){var r=getPlayerFlyingCrewToPlanet(oponentId,t,n);var i=getPlayerFlyingCrewToPlanet(id,t,n);var s=0;s=s+t.population;s=s+Math.max(firing_params[0],-PlanetPopulation.getMaxPopulation(t.size));s=s+firing_params[2]*(i-r);if(r-i>PlanetPopulation.getMaxPopulation(t.size))s=-1e3;return s};var modifyFiringParameters=function(e,t,n,r){if(e-t<=1&&e-t>=-1){zone="fighting";if(e<=1)firing_params=FP_DRAW1;if(e>=2)firing_params=FP_DRAW2}if(e-t>=1&&getPlayerScore(id,r)-getPlayerScore(oponentId,r)>=WIN_ZONE){if(t>=2){zone="fighting";firing_params=FP_WIN1}if(t<=1&&n>0&&e>=3){zone="protecting";firing_params=FP_WIN2}if(t<=1&&n==0){zone="filling";firing_params=FP_WIN3}}if(e-t<=-2||getPlayerScore(id,r)-getPlayerScore(oponentId,r)<=-50){zone="fighting";firing_params=FP_LOOSE}return e};var modifyScoreParameters=function(e,t,n,r){if(e-t<=1&&e-t>=-1){zone="fighting";if(e<=2)score_weights=SP_DRAW1;if(e>=3)score_weights=SP_DRAW2}if(e-t>=1&&getPlayerScore(id,r)-getPlayerScore(oponentId,r)>=WIN_ZONE){if(t>=2){zone="fighting";score_weights=SP_WIN1}if(t<=1&&n>0&&e>=3){zone="protecting";score_weights=SP_WIN2}if(t<=1&&n==0){zone="filling";score_weights=SP_WIN3}}if(e-t<=-2){zone="fighting";score_weights=SP_LOOSE}return e};var getNearestPlanet=function(e,t){var n=t[0];var r=GameUtil.getDistanceBetween(new Point(e.x,e.y),new Point(n.x,n.y));for(var i=0;i<t.length;i++){var s=t[i];if(r>GameUtil.getDistanceBetween(new Point(e.x,e.y),new Point(s.x,s.y))){r=GameUtil.getDistanceBetween(new Point(e.x,e.y),new Point(s.x,s.y));n=s}}return n};var getMyPlanetToFill=function(e,t){var n=t[0];var r=getMyPlanetFillingScore(e,n);for(var i=0;i<t.length;i++){var s=t[i];if(r<getMyPlanetFillingScore(e,s)){r=getMyPlanetFillingScore(e,s);n=s}}if(r<=60)zone="fighting";return n};var getMyPlanetFillingScore=function(e,t){var n=0;n=n+PlanetPopulation.getMaxPopulation(t.size)-t.population;return n};var getTargetPlanetForGroupAttack=function(e,t,n){var r=t[0];var i=-3e4;debugMessage+=" | group attack scores : ";for(var s=0;s<t.length;s++){var o=0;var u=t[s];for(var a=0;a<e.length;a++){var f=e[a];o+=getPlanetScore(f,u,n)}debugMessage+="p"+u.id+":"+o+",";if(i<o){i=o;r=u}}debugMessage+=" | Best target : p"+r.id;return r};var getBestScoredPlanet=function(e,t,n){var r=t[0];var i=getPlanetScore(e,r,n);for(var s=0;s<t.length;s++){var o=t[s];if(i<getPlanetScore(e,o,n)){i=getPlanetScore(e,o,n);r=o}}return r};var getOtherPlayerId=function(e,t){var n=GameUtil.getEnnemyPlanets(id,t);var r=n[0].owner.id;return r};var getOtherPlayerPlanets=function(e,t){var n=new Array;var r=0,i=t.content.length;while(r<i){var s=r++;var o=t.content[s];if(o.owner.id==e)n.push(o)}return n};var Galaxy=function(e,t){this.width=e;this.height=t;this.content=new Array;this.fleet=new Array};var Range=function(e,t){if(t==null)t=1;if(e==null)e=0;this.from=e;this.to=t};var Order=function(e,t,n){this.sourceID=e;this.targetID=t;this.numUnits=n};var Planet=function(e,t,n,r){if(n==null)n=2;if(t==null)t=0;if(e==null)e=0;this.x=e;this.y=t;this.size=n;this.owner=r;this.population=PlanetPopulation.getDefaultPopulation(n);this.id=UID.get()};var Ship=function(e,t,n,r){this.crew=e;this.source=t;this.target=n;this.owner=t.owner;this.creationTurn=r;this.travelDuration=Math.ceil(GameUtil.getDistanceBetween(new Point(t.x,t.y),new Point(n.x,n.y))/Game.SHIP_SPEED)};var TurnMessage=function(e,t){this.playerId=e;this.galaxy=t};var TurnResult=function(e,t){if(t==null)t="";this.orders=e;this.consoleMessage=t;this.error=""};var Point=function(e,t){this.x=e;this.y=t};var GameUtil={};GameUtil.getDistanceBetween=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};GameUtil.getPlayerPlanets=function(e,t){var n=new Array;var r=0,i=t.content.length;while(r<i){var s=r++;var o=t.content[s];if(o.owner.id==e)n.push(o)}return n};GameUtil.getEnnemyPlanets=function(e,t){var n=new Array;var r=0,i=t.content.length;while(r<i){var s=r++;var o=t.content[s];if(o.owner.id!=e)n.push(o)}return n};GameUtil.getEnnemyFleet=function(e,t){var n=new Array;var r=0,i=t.fleet.length;while(r<i){var s=r++;var o=t.fleet[s];if(o.owner.id!=e)n.push(o)}return n};GameUtil.getPlayerFleet=function(e,t){var n=new Array;var r=0,i=t.fleet.length;while(r<i){var s=r++;var o=t.fleet[s];if(o.owner.id==e)n.push(o)}return n};GameUtil.getTravelNumTurn=function(e,t){var n=Math.ceil(GameUtil.getDistanceBetween(new Point(e.x,e.y),new Point(t.x,t.y))/Game.SHIP_SPEED);return n};var UID={};UID.lastUID=0;UID.get=function(){UID.lastUID++;return UID.lastUID};var Game={};Game.DEFAULT_PLAYER_POPULATION=100;Game.NUM_PLANET=new Range(5,10);Game.PLANET_GROWTH=5;Game.SHIP_SPEED=60;Game.GAME_SPEED=500;Game.GAME_DURATION=240;Game.GAME_MAX_NUM_TURN=500;var PlanetPopulation={};PlanetPopulation.DEFAULT_SMALL=20;PlanetPopulation.DEFAULT_NORMAL=30;PlanetPopulation.DEFAULT_BIG=40;PlanetPopulation.DEFAULT_HUGE=50;PlanetPopulation.MAX_SMALL=50;PlanetPopulation.MAX_NORMAL=100;PlanetPopulation.MAX_BIG=200;PlanetPopulation.MAX_HUGE=300;PlanetPopulation.getMaxPopulation=function(e){var t=1;switch(e){case PlanetSize.SMALL:t=PlanetPopulation.MAX_SMALL;break;case PlanetSize.NORMAL:t=PlanetPopulation.MAX_NORMAL;break;case PlanetSize.BIG:t=PlanetPopulation.MAX_BIG;break;case PlanetSize.HUGE:t=PlanetPopulation.MAX_HUGE;break}return t};PlanetPopulation.getDefaultPopulation=function(e){var t=1;switch(e){case PlanetSize.SMALL:t=PlanetPopulation.DEFAULT_SMALL;break;case PlanetSize.NORMAL:t=PlanetPopulation.DEFAULT_NORMAL;break;case PlanetSize.BIG:t=PlanetPopulation.DEFAULT_BIG;break;case PlanetSize.HUGE:t=PlanetPopulation.DEFAULT_HUGE;break}return t};var PlanetSize={};PlanetSize.SMALL=1;PlanetSize.NORMAL=2;PlanetSize.BIG=3;PlanetSize.HUGE=4