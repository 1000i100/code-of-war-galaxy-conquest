var name="basicIA_JS",color=0,debugMessage="",turn=0,myPoints=[],oponentPoints=[],diffPoints=[],gameScore=[],maxGameScore=0,WIN_ZONE_POINTS=400,LOOSE_ZONE_POINTS=-50,WIN_ZONE_PLANETS=1,LOOSE_ZONE_PLANETS=-1,DEFENSIVE_STRAT=1.3,POP_SEUIL_1=-30,POP_SEUIL_2=-50,CREW_DRAW1=30,CREW_DRAW2=30,FP_DRAW1=[POP_SEUIL_1,CREW_DRAW1,DEFENSIVE_STRAT],FP_DRAW2=[POP_SEUIL_2,CREW_DRAW2,DEFENSIVE_STRAT],FP_WIN1=[-30,15,DEFENSIVE_STRAT],FP_WIN2=[-20,20,DEFENSIVE_STRAT],FP_WIN3=[-300,5,DEFENSIVE_STRAT],FP_LOOSE=[-55,55, DEFENSIVE_STRAT],RANGE=[-1,-5,-10,-15,-20],AGRESSIVITY=[-300,0,10,20,30],ATTACK_STRAT=0.5,RANGE_1=-3,AGRESSIVITY_1=10,RANGE_2=-3,AGRESSIVITY_2=10,AGRESSIVITY_3=-100,AGRESSIVITY_4=-300,SP_DRAW1=[RANGE_1,AGRESSIVITY_1,ATTACK_STRAT],SP_DRAW2=[RANGE_2,AGRESSIVITY_2,ATTACK_STRAT],SP_WIN1=[RANGE_2,AGRESSIVITY_3,ATTACK_STRAT],SP_WIN2=[RANGE_2,AGRESSIVITY_4,0],SP_WIN3=[RANGE_2,AGRESSIVITY_4,0],SP_LOOSE=[RANGE_2,0,ATTACK_STRAT],score_weights=SP_DRAW1,firing_params=FP_DRAW1,FIRING_POP=[20,30,50,100,300],CREW_SIZE= [5,10,20,30,50],zone="fighting",id=0,oponentId=-1;onmessage=function(b){null!=b.data?(b=b.data,id=b.playerId,postMessage(new TurnResult(getOrders(b.galaxy),debugMessage))):postMessage("data null")}; var getOrders=function(b){var a=[],c=GameUtil.getPlayerPlanets(id,b),d=GameUtil.getEnnemyPlanets(id,b);0>oponentId&&(oponentId=getOtherPlayerId(id,b));var f=getOtherPlayerPlanets(oponentId,b),e=0;myPoints.push(getPlayerScore(id,b));oponentPoints.push(getPlayerScore(oponentId,b));diffPoints.push(myPoints[turn]-oponentPoints[turn]);0==turn?gameScore.push(0):gameScore.push(1E3*diffPoints[turn]/turn);gameScore[turn]>maxGameScore&&(maxGameScore=gameScore[turn]);debugMessage="Points : "+myPoints[turn]+ ","+oponentPoints[turn]+","+diffPoints[turn]+","+turn;10<=turn&&(e=diffPoints[turn]-diffPoints[turn-10]);debugMessage+=" | ROC10 :"+e;debugMessage+=" | Score :"+gameScore[turn];debugMessage+=" | maxScore :"+maxGameScore;turn++;if(null!=d&&0<d.length&&null!=f&&0<f.length&&null!=c&&0<c.length){var e=c.length,g=f.length,k=d.length-f.length;modifyFiringParameters(e,g,k,b);modifyScoreParameters(e,g,k,b);for(e=0;e<c.length;e++)if(g=c[e],1>=turn){var k=getBestScoredPlanet(g,d,b),h=k.population+1+5*GameUtil.getTravelNumTurn(g, k);a.push(new Order(g.id,k.id,h))}else"protecting"!=zone&&"filling"!=zone||getNearestPlanet(f[0],c)!=g?0<=firingScore(id,g,b)?(h=Math.min(firing_params[1],g.population),"filling"==zone&&a.push(new Order(g.id,getMyPlanetToFill(g,c).id,h)),"fighting"!=zone&&"protecting"!=zone||a.push(new Order(g.id,getBestScoredPlanet(g,d,b).id,h))):-1E3==firingScore(id,g,b)?(debugMessage+=" | fuite de la plan\u00e8te "+g.id,h=g.population,a.push(new Order(g.id,getBestScoredPlanet(g,d,b).id,h))):g.population==PlanetPopulation.getMaxPopulation(g.size)&& (debugMessage+=" | attaque cause pleine, plan\u00e8te "+g.id,h=5,a.push(new Order(g.id,getBestScoredPlanet(g,d,b).id,h))):(h=5,a.push(new Order(g.id,f[0].id,h)))}return a},getPlayerScore=function(b,a){var c=getPlayerFlyingCrew(b,a),d=getPlayerPopulationOnPlanets(b,a);return c+d},getPlayerFlyingCrew=function(b,a){var c=0,d=GameUtil.getPlayerFleet(b,a);if(null!=d)for(var f=0;f<d.length;f++)c+=d[f].crew;return c},getPlayerPopulationOnPlanets=function(b,a){var c=0,d=GameUtil.getPlayerPlanets(b,a);if(null!= d)for(var f=0;f<d.length;f++)c+=d[f].population;return c},getPlayerFlyingCrewToPlanet=function(b,a,c){var d=0;b=getPlayerShipsToPlanet(b,a,c);if(null!=b)for(a=0;a<b.length;a++)d+=b[a].crew;return d},getPlayerShipsToPlanet=function(b,a,c){b=GameUtil.getPlayerFleet(b,c);c=[];if(null!=b)for(var d=0;d<b.length;d++)b[d].target.id==a.id&&c.push(b[d]);return c},getPlanetScore=function(b,a,c){var d=getPlayerFlyingCrewToPlanet(oponentId,a,c);c=getPlayerFlyingCrewToPlanet(id,a,c);var f;f=0-a.population;f+= score_weights[0]*GameUtil.getTravelNumTurn(b,a);a.owner.id==oponentId&&(f+=score_weights[1]);f+=score_weights[2]*(c-d);c-d>PlanetPopulation.getMaxPopulation(a.size)&&(f-=500);return f},firingScore=function(b,a,c){b=getPlayerFlyingCrewToPlanet(oponentId,a,c);c=getPlayerFlyingCrewToPlanet(id,a,c);var d;d=0+a.population;d+=Math.max(firing_params[0],-PlanetPopulation.getMaxPopulation(a.size));d+=firing_params[2]*(c-b);b-c>PlanetPopulation.getMaxPopulation(a.size)&&(d=-1E3);return d},modifyFiringParameters= function(b,a,c,d){b-a<=WIN_ZONE_PLANETS&&b-a>=LOOSE_ZONE_PLANETS&&(zone="fighting",2>=b&&(firing_params=FP_DRAW1),3<=b&&(firing_params=FP_DRAW2));b-a>=WIN_ZONE_PLANETS&&getPlayerScore(id,d)-getPlayerScore(oponentId,d)>=WIN_ZONE_POINTS&&(2<=a&&(zone="fighting",firing_params=FP_WIN1),1>=a&&0<c&&3<=b&&(zone="protecting",firing_params=FP_WIN2),1>=a&&0==c&&(zone="filling",firing_params=FP_WIN3));if(b-a<=LOOSE_ZONE_PLANETS||getPlayerScore(id,d)-getPlayerScore(oponentId,d)<=LOOSE_ZONE_POINTS)zone="fighting", firing_params=FP_LOOSE;return b},modifyScoreParameters=function(b,a,c,d){b-a<=WIN_ZONE_PLANETS&&b-a>=LOOSE_ZONE_PLANETS&&(zone="fighting",2>=b&&(score_weights=SP_DRAW1),3<=b&&(score_weights=SP_DRAW2));b-a>=WIN_ZONE_PLANETS&&getPlayerScore(id,d)-getPlayerScore(oponentId,d)>=WIN_ZONE_POINTS&&(2<=a&&(zone="fighting",score_weights=SP_WIN1),1>=a&&0<c&&3<=b&&(zone="protecting",score_weights=SP_WIN2),1>=a&&0==c&&(zone="filling",score_weights=SP_WIN3));if(b-a<=LOOSE_ZONE_PLANETS||getPlayerScore(id,d)-getPlayerScore(oponentId, d)<=LOOSE_ZONE_POINTS)zone="fighting",score_weights=SP_LOOSE;return b},getNearestPlanet=function(b,a){for(var c=a[0],d=GameUtil.getDistanceBetween(new Point(b.x,b.y),new Point(c.x,c.y)),f=0;f<a.length;f++){var e=a[f];d>GameUtil.getDistanceBetween(new Point(b.x,b.y),new Point(e.x,e.y))&&(d=GameUtil.getDistanceBetween(new Point(b.x,b.y),new Point(e.x,e.y)),c=e)}return c},getMyPlanetToFill=function(b,a){for(var c=a[0],d=getMyPlanetFillingScore(b,c),f=0;f<a.length;f++){var e=a[f];d<getMyPlanetFillingScore(b, e)&&(d=getMyPlanetFillingScore(b,e),c=e)}60>=d&&(zone="fighting");return c},getMyPlanetFillingScore=function(b,a){var c;return c=0+PlanetPopulation.getMaxPopulation(a.size)-a.population},getTargetPlanetForGroupAttack=function(b,a,c){var d=a[0],f=-3E4;debugMessage+=" | group attack scores : ";for(var e=0;e<a.length;e++){for(var g=0,k=a[e],h=0;h<b.length;h++)g+=getPlanetScore(b[h],k,c);debugMessage+="p"+k.id+":"+g+",";f<g&&(f=g,d=k)}debugMessage+=" | Best target : p"+d.id;return d},getBestScoredPlanet= function(b,a,c){for(var d=a[0],f=getPlanetScore(b,d,c),e=0;e<a.length;e++){var g=a[e];f<getPlanetScore(b,g,c)&&(f=getPlanetScore(b,g,c),d=g)}return d},getOtherPlayerId=function(b,a){return GameUtil.getEnnemyPlanets(id,a)[0].owner.id},getOtherPlayerPlanets=function(b,a){for(var c=[],d=0,f=a.content.length;d<f;){var e=d++,e=a.content[e];e.owner.id==b&&c.push(e)}return c},Galaxy=function(b,a){this.width=b;this.height=a;this.content=[];this.fleet=[]},Range=function(b,a){null==a&&(a=1);null==b&&(b=0); this.from=b;this.to=a},Order=function(b,a,c){this.sourceID=b;this.targetID=a;this.numUnits=c},Planet=function(b,a,c,d){null==c&&(c=2);null==a&&(a=0);null==b&&(b=0);this.x=b;this.y=a;this.size=c;this.owner=d;this.population=PlanetPopulation.getDefaultPopulation(c);this.id=UID.get()},Ship=function(b,a,c,d){this.crew=b;this.source=a;this.target=c;this.owner=a.owner;this.creationTurn=d;this.travelDuration=Math.ceil(GameUtil.getDistanceBetween(new Point(a.x,a.y),new Point(c.x,c.y))/Game.SHIP_SPEED)},TurnMessage= function(b,a){this.playerId=b;this.galaxy=a},TurnResult=function(b,a){null==a&&(a="");this.orders=b;this.consoleMessage=a;this.error=""},Point=function(b,a){this.x=b;this.y=a},GameUtil={getDistanceBetween:function(b,a){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},getPlayerPlanets:function(b,a){for(var c=[],d=0,f=a.content.length;d<f;){var e=d++,e=a.content[e];e.owner.id==b&&c.push(e)}return c},getEnnemyPlanets:function(b,a){for(var c=[],d=0,f=a.content.length;d<f;){var e=d++,e=a.content[e]; e.owner.id!=b&&c.push(e)}return c},getEnnemyFleet:function(b,a){for(var c=[],d=0,f=a.fleet.length;d<f;){var e=d++,e=a.fleet[e];e.owner.id!=b&&c.push(e)}return c},getPlayerFleet:function(b,a){for(var c=[],d=0,f=a.fleet.length;d<f;){var e=d++,e=a.fleet[e];e.owner.id==b&&c.push(e)}return c},getTravelNumTurn:function(b,a){return Math.ceil(GameUtil.getDistanceBetween(new Point(b.x,b.y),new Point(a.x,a.y))/Game.SHIP_SPEED)}},UID={lastUID:0,get:function(){UID.lastUID++;return UID.lastUID}},Game={DEFAULT_PLAYER_POPULATION:100}; Game.NUM_PLANET=new Range(5,10);Game.PLANET_GROWTH=5;Game.SHIP_SPEED=60;Game.GAME_SPEED=500;Game.GAME_DURATION=240;Game.GAME_MAX_NUM_TURN=500; var PlanetPopulation={DEFAULT_SMALL:20,DEFAULT_NORMAL:30,DEFAULT_BIG:40,DEFAULT_HUGE:50,MAX_SMALL:50,MAX_NORMAL:100,MAX_BIG:200,MAX_HUGE:300,getMaxPopulation:function(b){var a=1;switch(b){case PlanetSize.SMALL:a=PlanetPopulation.MAX_SMALL;break;case PlanetSize.NORMAL:a=PlanetPopulation.MAX_NORMAL;break;case PlanetSize.BIG:a=PlanetPopulation.MAX_BIG;break;case PlanetSize.HUGE:a=PlanetPopulation.MAX_HUGE}return a},getDefaultPopulation:function(b){var a=1;switch(b){case PlanetSize.SMALL:a=PlanetPopulation.DEFAULT_SMALL; break;case PlanetSize.NORMAL:a=PlanetPopulation.DEFAULT_NORMAL;break;case PlanetSize.BIG:a=PlanetPopulation.DEFAULT_BIG;break;case PlanetSize.HUGE:a=PlanetPopulation.DEFAULT_HUGE}return a}},PlanetSize={SMALL:1,NORMAL:2,BIG:3,HUGE:4};