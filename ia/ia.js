(function(){var n,t,e,r,o,i,u,a,l,s,c,h,f,p,g,M,w,A,T,E,L,D,_,P,v,y,d,U;y="IA 1nomable",g=0,w="",v=0,p=0,M=5,this.onmessage=function(n){var t;return null!=n.data?(t=n.data,v=t.playerId,postMessage(new h(D(t.galaxy),w))):postMessage("data null")},D=function(n){var t,o,u,a,l,s,c,h,f,g,M,L,D,y,d,m,x,N,I,G,S,B,F,H;w="<br>Tour "+p,g=[];try{if(l=e.getPlayerPlanets(v,n),s=e.getEnnemyPlanets(v,n),null!==s&&s.length>0)for(m=0,G=l.length;G>m;m++){for(a=l[m],y=T(a,n,s),L=y[Math.floor(Math.random()*y.length)],d=e.getTravelNumTurn(a,L),D=U(L,n,d),h=1+U(L,n,e.getTravelNumTurn(a,L)).population,a.population>h&&(g.push(new r(a.id,L.id,h)),a.population-=h),U(a,n,1).population>=i.getMaxPopulation(a.size)&&(L=E(a,n,s),h=Math.min(a.population,1+U(L,n,e.getTravelNumTurn(a,L)).population),g.push(new r(a.id,L.id,h)),a.population-=h),o=_(a,e.getEnnemyFleets(v,n)),u=!1,x=0,S=o.length;S>x;x++)M=o[x],1===P(M)-p&&(u=!0);if(u){for(f=0,N=0,B=o.length;B>N;N++)M=o[N],f+=M.crew;f>i.getMaxPopulation(a.size)&&(g=A(a,n,g))}for(U(a,n,1).population>=i.getMaxPopulation(a.size)&&(L=E(a,n,s),h=Math.min(a.population,1+U(L,n,e.getTravelNumTurn(a,L)).population),g.push(new r(a.id,L.id,h))),H=n.content,I=0,F=H.length;F>I;I++)c=H[I],c!==a&&g.push(new r(a.id,c.id,0))}}catch(O){t=O,w+=t}return p++,g},A=function(n,t,e){var o;return o=L(n,t.content),e.push(new r(n.id,o.id,n.population)),e},d=function(n,t){return Math.min(n.population+t*M,i.getMaxPopulation(n.size))},U=function(n,t,e){var r,o,u,a,l,s,c,h;for(o={size:n.size,population:n.population,owner:n.owner,id:n.id,x:n.x,y:n.y,ref:n},u=o.population-5,r=_(o.ref,t.fleet),l=s=0;e>=0?e>=s:s>=e;l=e>=0?++s:--s){for(c=0,h=r.length;h>c;c++)a=r[c],P(a)===p+l&&(a.owner===o.owner?u=Math.min(u+a.crew,i.getMaxPopulation(o.size)):(u-=a.crew,0>u&&(u=-u,o.owner=a.owner)));u=Math.min(u+M,i.getMaxPopulation(o.size))}return o.population=u,o},P=function(n){return n.creationTurn+n.travelDuration},_=function(n,t){var e,r,o,i;for(e=[],o=0,i=t.length;i>o;o++)r=t[o],r.target===n&&e.push(r);return e},L=function(n,t){var r,o,i,u,l,s;for(u=t[0],r=e.getDistanceBetween(new a(n.x,n.y),new a(u.x,u.y)),l=0,s=t.length;s>l;l++)i=t[l],o=e.getDistanceBetween(new a(n.x,n.y),new a(i.x,i.y)),r>o&&(r=o,u=i);return u},E=function(n,t,r){var o,i,u,a,l,s,c,h;for(r||(r=t.content),l=r[0],s=e.getTravelNumTurn(n,r[0]),a=U(l,t,s),u=a.owner===l.owner?a.population:9999,c=0,h=r.length;h>c;c++)i=r[c],s=e.getTravelNumTurn(n,i),a=U(i,t,s),o=a.owner===i.owner?a.population:9999,u>o&&(u=o,l=i);return l},T=function(n,t,r){var o,i,u,a,l,s,c,h,f;for(i=E(n,t,r),c=e.getTravelNumTurn(n,i),l=U(i,t,c),a=l.owner===i.owner?l.population:9999,s=[],h=0,f=r.length;f>h;h++)u=r[h],c=e.getTravelNumTurn(n,u),l=U(u,t,c),o=l.owner===u.owner?l.population:9999,a+10>=o&&s.push(u);return s},n=function(){function n(n,t){this.width=n,this.height=t,this.content=[],this.fleet=[]}return n}(),l=function(){function n(n,t){this.from=n,this.to=t}return n}(),r=function(){function n(n,t,e){this.sourceID=n,this.targetID=t,this.numUnits=e}return n}(),o=function(){function n(n,t,e,r){this.x=n,this.y=t,this.size=e,this.owner=r,this.population=i.getDefaultPopulation(e),this.id=f.get()}return n}(),s=function(){function n(n,r,o,i){this.crew=n,this.source=r,this.target=o,this.creationTurn=i,this.owner=r.owner,this.travelDuration=Math.ceil(e.getDistanceBetween(new a(r.x,r.y),new a(o.x,o.y))/t.SHIP_SPEED)}return n}(),c=function(){function n(n,t){this.playerId=n,this.galaxy=t}return n}(),h=function(){function n(n,t){this.orders=n,this.consoleMessage=null!=t?t:"",this.error=""}return n}(),a=function(){function n(n,t){this.x=n,this.y=t}return n}(),e=function(){function n(){}return n.getDistanceBetween=function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},n.getPlayerPlanets=function(n,t){var e,r,o,i,u;for(r=[],u=t.content,o=0,i=u.length;i>o;o++)e=u[o],e.owner.id===n&&r.push(e);return r},n.getEnnemyPlanets=function(n,t){var e,r,o,i,u;for(r=[],u=t.content,o=0,i=u.length;i>o;o++)e=u[o],e.owner.id!==n&&r.push(e);return r},n.getEnnemyFleets=function(n,t){var e,r,o,i,u;for(e=[],u=t.fleet,o=0,i=u.length;i>o;o++)r=u[o],r.owner.id!==n&&e.push(r);return e},n.getMyFleets=function(n,t){var e,r,o,i,u;for(e=[],u=t.fleet,o=0,i=u.length;i>o;o++)r=u[o],r.owner.id===n&&e.push(r);return e},n.getTravelNumTurn=function(e,r){return Math.ceil(n.getDistanceBetween(new a(e.x,e.y),new a(r.x,r.y))/t.SHIP_SPEED)},n}(),f=function(){function n(){}return n.lastUID=0,n.get=function(){return n.lastUID++,n.lastUID},n}(),t=function(){function n(){}return n.DEFAULT_PLAYER_POPULATION=100,n.NUM_PLANET=new l(5,10),n.PLANET_GROWTH=5,n.SHIP_SPEED=60,n.GAME_SPEED=500,n.GAME_DURATION=240,n.GAME_MAX_NUM_TURN=500,n}(),i=function(){function n(){}return n.DEFAULT_SMALL=20,n.DEFAULT_NORMAL=30,n.DEFAULT_BIG=40,n.DEFAULT_HUGE=50,n.MAX_SMALL=50,n.MAX_NORMAL=100,n.MAX_BIG=200,n.MAX_HUGE=300,n.getMaxPopulation=function(t){var e;switch(e=1,t){case u.SMALL:e=n.MAX_SMALL;break;case u.NORMAL:e=n.MAX_NORMAL;break;case u.BIG:e=n.MAX_BIG;break;case u.HUGE:e=n.MAX_HUGE}return e},n.getDefaultPopulation=function(t){var e;switch(e=1,t){case u.SMALL:e=n.DEFAULT_SMALL;break;case u.NORMAL:e=n.DEFAULT_NORMAL;break;case u.BIG:e=n.DEFAULT_BIG;break;case u.HUGE:e=n.DEFAULT_HUGE}return e},n}(),u=function(){function n(){}return n.SMALL=1,n.NORMAL=2,n.BIG=3,n.HUGE=4,n}()}).call(this);