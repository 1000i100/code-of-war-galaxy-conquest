(function(){var n,t,r,o,e,u,a,i,l,p,h,f,c,s,w,g,v,m,d,M,x,P,y,D,b,z,I,T,E,q,U,$,j,k,A,B,C,F,G;j=0,t="a",h="e",D="n",s=13,x=!1,a=5,G=60,u=0,i="",M=0,z=[],w={},this.onmessage=function(n){return null!=n.data?(i="<br>Tour "+j+"<br>",M=n.data.playerId,w=n.data.galaxy,r(),z=[],d(),x&&(i=c()),postMessage({orders:z,consoleMessage:'<span style="color:white">'+i+"</span>",error:""}),j++):postMessage("data null")},d=function(){var n,t,r,o,e,u,a,l,p,h,c,s,m,d,M,y,D,b,z;try{if(e=P(),u=E(),null!==u&&u.length>0){for(z=[],M=0,D=e.length;D>M;M++){if(o=e[M],m=g(o,u),c=m[Math.floor(Math.random()*m.length)],d=A(o,c),s=I(c,d),l=1+I(c,A(o,c)).population,o.population>l&&$(o,c,l),I(o,1).population>=o.maxPop&&(c=v(o,therPlanets),l=Math.min(o.population,1+I(c,A(o,c)).population),$(o,c,l)),t=B(o,C()),F(j,t).length){for(n=B(o),p=0,y=0,b=t.length;b>y;y++)h=t[y],p+=h.crew;p>o.maxPop&&f(o)}I(o,2).population>=o.maxPop&&(c=v(o,u),l=Math.min(o.population,1+I(c,A(o,c)).population),$(o,c,l)),x?z.push(function(){var n,t,r,e;for(r=w.content,e=[],n=0,t=r.length;t>n;n++)a=r[n],a!==o?e.push($(o,a,0)):e.push(void 0);return e}()):z.push(void 0)}return z}}catch(T){return r=T,i+=r}},$=function(t,r,o){return z.push({sourceID:t.id,targetID:r.id,numUnits:o}),o?(w.fleet.push(new n(o,t,r,j)),t.population-=o):void 0},F=function(n,t){var r,o,e,u;for(null==t&&(t=w.fleet),r=[],e=0,u=t.length;u>e;e++)o=t[e],n===k(o)&&r.push(o);return r},f=function(n){var t;return t=m(n,T()),n.population?$(n,t,n.population):void 0},b=function(n,t){return Math.min(n.population+t*a,n.maxPop)},o=function(n,t){var r,o,u,a,i,l,p;return null==t&&(t=s),u=e(n),p=B(u.ref),i={mesPertes:0,pertesEnnemi:0,maProd:0,prodEnnemi:0},r=0,a=0,o=j,l=F(o,p),i},e=function(n){var t;return t={size:n.size,population:n.population,maxPop:U(n),owner:n.owner,id:n.id,x:n.x,y:n.y,ref:n}},I=function(n,t){var r,o,u,i,l,p,h,f;for(o=e(n),u=o.population-5,r=B(o.ref),l=p=0;t>=0?t>=p:p>=t;l=t>=0?++p:--p){for(h=0,f=r.length;f>h;h++)i=r[h],k(i)===j+l&&(i.owner===o.owner?u=Math.min(u+i.crew,o.maxPop):(u-=i.crew,0>u&&(u=-u,o.owner=i.owner)));u=Math.min(u+a,o.maxPop)}return o.population=u,o},k=function(n){return n.creationTurn+n.travelDuration},B=function(n,t){var r,o,e,u;for(null==t&&(t=w.fleet),r=[],e=0,u=t.length;u>e;e++)o=t[e],o.target===n&&r.push(o);return r},m=function(n,t){var r,o,e,u,a,i;for(u=t[0],r=p(n,u),a=0,i=t.length;i>a;a++)e=t[a],o=p(n,e),r>o&&o>0&&(r=o,u=e);return u},v=function(n,t){var r,o,e,u,a,i,l,p;for(t||(t=w.content),a=t[0],i=A(n,t[0]),u=I(a,i),e=u.owner===a.owner?u.population:9999,l=0,p=t.length;p>l;l++)o=t[l],i=A(n,o),u=I(o,i),r=u.owner===o.owner?u.population:9999,e>r&&(e=r,a=o);return a},g=function(n,t){var r,o,e,u,a,i,l,p,h;for(o=v(n,t),l=A(n,o),a=I(o,l),u=a.owner===o.owner?a.population:9999,i=[],p=0,h=t.length;h>p;p++)e=t[p],l=A(n,e),a=I(e,l),r=a.owner===e.owner?a.population:9999,u+10>=r&&i.push(e);return i},n=function(){function n(n,t,r,o){this.crew=n,this.source=t,this.target=r,this.creationTurn=o,this.owner=t.owner,this.travelDuration=Math.ceil(p(t,r)/G)}return n}(),l=function(n){return 13421772===n.owner.color?D:n.owner.id===M?t:h},P=function(n){var r,o,e,u;for(null==n&&(n=w.content),o=[],e=0,u=n.length;u>e;e++)r=n[e],l(r)===t&&o.push(r);return o},T=function(n){var t,r,o,e;for(null==n&&(n=w.content),r=[],o=0,e=n.length;e>o;o++)t=n[o],l(t)===h&&r.push(t);return r},q=function(n){var t,r,o,e;for(null==n&&(n=w.content),r=[],o=0,e=n.length;e>o;o++)t=n[o],l(t)===D&&r.push(t);return r},E=function(n){var r,o,e,u;for(null==n&&(n=w.content),o=[],e=0,u=n.length;u>e;e++)r=n[e],l(r)!==t&&o.push(r);return o},y=function(n){var t,r,o,e;for(null==n&&(n=w.fleet),t=[],o=0,e=n.length;e>o;o++)r=n[o],r.owner.id===M&&r.crew>0&&t.push(r);return t},C=function(n){var t,r,o,e;for(null==n&&(n=w.fleet),t=[],o=0,e=n.length;e>o;o++)r=n[o],r.owner.id!==M&&r.crew>0&&t.push(r);return t},A=function(n,t){return Math.ceil(p(n,t)/G)},p=function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},r=function(){var n,t,r,o,e;for(o=w.content,e=[],t=0,r=o.length;r>t;t++)n=o[t],e.push(n.maxPop=U(n));return e},U=function(n){return Math.max(50,100*(n.size-1))},c=function(){var n,t,r,o,e;for(r=140,n="#?!§*$£¤&@%µ#!¤#",o="",t=e=0;r>=0?r>=e:e>=r;t=r>=0?++e:--e)o+=n.substr(Math.floor(Math.random()*n.length),1);return o}}).call(this);